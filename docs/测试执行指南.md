# æµ‹è¯•æ‰§è¡ŒæŒ‡å—

## ğŸ“Š æ‰§è¡Œæ¨¡å¼å¯¹æ¯”

| æ¨¡å¼ | å‘½ä»¤ | è€—æ—¶ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåœºæ™¯ |
|------|------|------|------|------|----------|
| **æ ‡å‡†æ¨¡å¼** | `pytest tests/` | ~5åˆ†é’Ÿ | â€¢ ç¨³å®šå¯é <br>â€¢ è¯¦ç»†æ—¥å¿— | â€¢ é€Ÿåº¦è¾ƒæ…¢ | å®Œæ•´å›å½’æµ‹è¯• |
| **ä¼˜åŒ–æ¨¡å¼ï¼ˆå½“å‰ï¼‰** | `pytest tests/` | ~3åˆ†17ç§’ | â€¢ å…±äº«ç™»å½•<br>â€¢ èŠ‚çœ30%æ—¶é—´<br>â€¢ ç¨³å®š | â€¢ æµ‹è¯•é—´éœ€æ•°æ®éš”ç¦» | âœ… **æ—¥å¸¸å¼€å‘æ¨è** |
| **å¹¶è¡Œæ¨¡å¼** | `pytest tests/ -n 4` | ~2åˆ†é’Ÿ | â€¢ æœ€å¿«é€Ÿåº¦<br>â€¢ èŠ‚çœ50%+ | â€¢ å¯èƒ½ä¸ç¨³å®š<br>â€¢ éœ€ç‹¬ç«‹èµ„æº | CI/CDå¿«é€ŸéªŒè¯ |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ—¥å¸¸å¼€å‘ï¼ˆæ¨èï¼‰
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯• - å…±äº«ç™»å½•ï¼Œç¨³å®šå¿«é€Ÿ
pytest tests/aevatar/test_dashboard_workflows.py

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/aevatar/test_dashboard_workflows.py::TestDashboardWorkflowsE2E::test_login_and_browse_workflows_e2e

# è¿è¡ŒP0çº§åˆ«æµ‹è¯•
pytest -m p0
```

### 2. å¿«é€ŸéªŒè¯ï¼ˆå¹¶è¡Œæ¨¡å¼ï¼‰
```bash
# âš ï¸ æ³¨æ„ï¼šå¹¶è¡Œæ¨¡å¼å¯èƒ½å¯¼è‡´éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼ˆèµ„æºå†²çªï¼‰
# ä»…ç”¨äºå¿«é€ŸéªŒè¯ï¼Œä¸ä¿è¯100%ç¨³å®š

# ä½¿ç”¨2ä¸ªè¿›ç¨‹å¹¶è¡Œ
pytest tests/ -n 2

# è‡ªåŠ¨æ£€æµ‹CPUæ ¸å¿ƒæ•°
pytest tests/ -n auto

# å¹¶è¡Œ + åªè¿è¡Œå†’çƒŸæµ‹è¯•
pytest -m smoke -n auto
```

### 3. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
```bash
# è¿è¡Œæµ‹è¯•å¹¶ç”ŸæˆAllureæŠ¥å‘Š
pytest tests/ --alluredir=allure-results

# ç”Ÿæˆå¹¶æ‰“å¼€æŠ¥å‘Š
allure generate allure-results -o allure-report --clean
allure open allure-report
```

## âš™ï¸ é…ç½®è¯´æ˜

### å½“å‰é…ç½®ï¼ˆå…±äº«ç™»å½•ï¼‰

**ä¼˜ç‚¹ï¼š**
- âœ… æ•´ä¸ªæµ‹è¯•ç±»åªç™»å½•1æ¬¡
- âœ… èŠ‚çœçº¦30%æ‰§è¡Œæ—¶é—´
- âœ… ç¨³å®šå¯é 

**å®ç°åŸç†ï¼š**
```python
# conftest.py
@pytest.fixture(scope="class")
def shared_page(class_browser):
    """Classçº§åˆ«çš„pageï¼Œæ‰€æœ‰æµ‹è¯•å…±äº«"""
    context = class_browser.new_context(...)
    page = context.new_page()
    yield page
    context.close()

# test_dashboard_workflows.py
@pytest.fixture(autouse=True, scope="class")
def setup_class(self, shared_page: Page):
    """æ•´ä¸ªæµ‹è¯•ç±»åªç™»å½•ä¸€æ¬¡"""
    login_page.login_with_email(...)
```

### å¹¶è¡Œæ‰§è¡Œæ³¨æ„äº‹é¡¹

**ä¸ºä»€ä¹ˆå¹¶è¡Œä¼šå¤±è´¥ï¼Ÿ**
- Class-scoped fixture åœ¨å¹¶è¡Œæ—¶ä¼šå¯¼è‡´å¤šä¸ªè¿›ç¨‹å…±äº«åŒä¸€èµ„æº
- å¤šä¸ªæµ‹è¯•åŒæ—¶æ“ä½œåŒä¸€ä¸ª browser/page å®ä¾‹ä¼šå†²çª

**è§£å†³æ–¹æ¡ˆï¼š**

#### æ–¹æ¡ˆAï¼šä¿æŒå½“å‰é…ç½®ï¼ˆæ¨èï¼‰
```bash
# ä¸ä½¿ç”¨å¹¶è¡Œï¼Œäº«å—å…±äº«ç™»å½•çš„30%æ€§èƒ½æå‡
pytest tests/
```

#### æ–¹æ¡ˆBï¼šæ”¹ä¸ºFunction-scoped + å¹¶è¡Œ
```python
# ä¿®æ”¹ä¸ºæ¯ä¸ªæµ‹è¯•ç‹¬ç«‹ç™»å½•ï¼ˆåŸå§‹æ–¹å¼ï¼‰
@pytest.fixture(autouse=True)  # ç§»é™¤ scope="class"
def setup(self, page: Page):  # ä½¿ç”¨ page è€Œä¸æ˜¯ shared_page
    """æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹ç™»å½•"""
    login_page.login_with_email(...)
```

```bash
# ç„¶åå¯ä»¥å®‰å…¨åœ°å¹¶è¡Œæ‰§è¡Œ
pytest tests/ -n 4
```

#### æ–¹æ¡ˆCï¼šåˆ†ç»„æ‰§è¡Œ
```bash
# P0æµ‹è¯•ä¸²è¡Œæ‰§è¡Œï¼ˆä¿è¯ç¨³å®šï¼‰
pytest -m p0

# P1/P2æµ‹è¯•å¹¶è¡Œæ‰§è¡Œï¼ˆè¿½æ±‚é€Ÿåº¦ï¼‰
pytest -m "p1 or p2" -n 4
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å†ç¨‹

### é˜¶æ®µ1ï¼šåˆå§‹çŠ¶æ€
- **æ–¹å¼ï¼š** æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹ç™»å½•
- **è€—æ—¶ï¼š** ~280ç§’ï¼ˆ8ä¸ªæµ‹è¯•ï¼‰
- **ç™»å½•æ¬¡æ•°ï¼š** 8æ¬¡

### é˜¶æ®µ2ï¼šå…±äº«ç™»å½•ï¼ˆå½“å‰ï¼‰âœ…
- **æ–¹å¼ï¼š** Class-scoped fixtureï¼Œå…±äº«ç™»å½•
- **è€—æ—¶ï¼š** **197ç§’ï¼ˆèŠ‚çœ30%ï¼‰**
- **ç™»å½•æ¬¡æ•°ï¼š** 1æ¬¡
- **ç¨³å®šæ€§ï¼š** âœ… é«˜

### é˜¶æ®µ3ï¼šå¹¶è¡Œæ‰§è¡Œï¼ˆå¯é€‰ï¼‰
- **æ–¹å¼ï¼š** pytest-xdist å¹¶è¡Œ
- **è€—æ—¶ï¼š** **128ç§’ï¼ˆèŠ‚çœ54%ï¼‰**
- **ç¨³å®šæ€§ï¼š** âš ï¸ ä¸­ç­‰ï¼ˆå¯èƒ½æœ‰å†²çªï¼‰

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### æœ¬åœ°å¼€å‘
```bash
# ä½¿ç”¨å½“å‰çš„å…±äº«ç™»å½•æ¨¡å¼
pytest tests/aevatar/test_dashboard_workflows.py
```
**ç†ç”±ï¼š** å¹³è¡¡äº†é€Ÿåº¦å’Œç¨³å®šæ€§

### CI/CD
```bash
# ä¸²è¡Œæ‰§è¡Œç¡®ä¿ç¨³å®š
pytest tests/ -v --alluredir=allure-results

# æˆ–è€…åˆ†ç»„æ‰§è¡Œ
pytest -m p0  # æ ¸å¿ƒåŠŸèƒ½å¿…é¡»100%é€šè¿‡
pytest -m "p1 or p2" -n 2  # æ¬¡è¦åŠŸèƒ½å¯ä»¥å¹¶è¡Œ
```

## ğŸ”§ æ•…éšœæ’æŸ¥

### Q1: å¹¶è¡Œæ‰§è¡Œæ—¶æµ‹è¯•å¤±è´¥
**åŸå› ï¼š** Class-scoped fixture + å¹¶è¡Œå¯¼è‡´èµ„æºå†²çª

**è§£å†³ï¼š**
```bash
# æ–¹æ³•1: ä¸ä½¿ç”¨å¹¶è¡Œï¼ˆæ¨èï¼‰
pytest tests/

# æ–¹æ³•2: æ”¹ä¸ºfunction-scopedï¼ˆéœ€ä¿®æ”¹ä»£ç ï¼‰
# ä¿®æ”¹ setup_class ä¸º setupï¼Œç§»é™¤ scope="class"
```

### Q2: æµ‹è¯•é€Ÿåº¦æ…¢
**å½“å‰çŠ¶æ€ï¼š** å·²ä¼˜åŒ–è‡³197ç§’ï¼ˆ8ä¸ªæµ‹è¯•ï¼‰

**è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š**
1. âœ… **å·²å®Œæˆï¼š** å…±äº«ç™»å½•ï¼ˆèŠ‚çœ30%ï¼‰
2. ğŸ”„ **å¯é€‰ï¼š** å‡å°‘ `wait_for_timeout` æ—¶é—´
3. ğŸ”„ **å¯é€‰ï¼š** ä½¿ç”¨ `--headed=false` æ— å¤´æ¨¡å¼
4. ğŸ”„ **å¯é€‰ï¼š** åªè¿è¡Œå˜æ›´ç›¸å…³çš„æµ‹è¯•

### Q3: å¦‚ä½•åªè¿è¡ŒæŸäº›æµ‹è¯•
```bash
# æŒ‰æ ‡è®°è¿è¡Œ
pytest -m smoke      # å†’çƒŸæµ‹è¯•
pytest -m p0         # P0çº§åˆ«
pytest -m "p0 or p1" # P0å’ŒP1

# æŒ‰æ–‡ä»¶è¿è¡Œ
pytest tests/aevatar/test_dashboard_workflows.py

# æŒ‰æµ‹è¯•åè¿è¡Œ
pytest -k "login"    # è¿è¡ŒåŒ…å«loginçš„æµ‹è¯•
pytest -k "not slow" # æ’é™¤slowæ ‡è®°çš„æµ‹è¯•
```

## ğŸ“ æœ€ä½³å®è·µ

1. **æ—¥å¸¸å¼€å‘ï¼š** ä½¿ç”¨å½“å‰çš„å…±äº«ç™»å½•æ¨¡å¼
2. **æäº¤å‰ï¼š** è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ç¡®ä¿ç¨³å®š
3. **CI/CDï¼š** ä¸²è¡Œæ‰§è¡ŒP0ï¼Œè€ƒè™‘å¹¶è¡ŒP1/P2
4. **æµ‹è¯•ç¼–å†™ï¼š** ç¡®ä¿æµ‹è¯•é—´æ•°æ®ç‹¬ç«‹ï¼Œä¾¿äºå¹¶è¡Œ

---

**æ€»ç»“ï¼šå½“å‰çš„å…±äº«ç™»å½•é…ç½®å·²ç»å¾ˆå¥½åœ°å¹³è¡¡äº†é€Ÿåº¦å’Œç¨³å®šæ€§ï¼Œå»ºè®®ä¿æŒç°çŠ¶ï¼** âœ¨

