# 登录功能测试计划

## 1. 测试概述

### 1.1 测试目标
验证Aevatar Station登录功能的完整性、安全性和用户体验，确保用户能够通过有效凭据成功登录系统，并对无效输入给出合适的错误提示。

### 1.2 测试范围
- **页面URL**: `https://localhost:44320/Account/Login`
- **测试类型**: 功能测试、负面测试、边界测试、UI测试、安全测试
- **测试优先级**: P0（核心功能）、P1（重要功能）、P2（次要功能）

### 1.3 页面元素清单
通过Playwright MCP识别的关键页面元素：

| 元素 | 类型 | 选择器/名称 | 必填 |
|------|------|-------------|------|
| 用户名输入框 | textbox | "用户名或电子邮件地址" | 是 |
| 密码输入框 | textbox | "密码" | 是 |
| 记住我复选框 | checkbox | "记住我" | 否 |
| 登录按钮 | button | "登录" | - |
| 显示/隐藏密码按钮 | button | (密码框旁边的按钮) | - |
| 注册链接 | link | "注册" | - |
| 忘记密码链接 | link | "忘记密码？" | - |
| 语言切换器 | button | "简体中文" | - |

---

## 2. 测试用例

### 2.1 功能测试 (Functional Tests) - P0/P1

#### TC-LOGIN-001: 使用有效用户名和密码登录
- **优先级**: P0
- **前置条件**: 系统中存在有效用户账号
- **测试步骤**:
  1. 访问登录页面
  2. 截图：登录页面初始状态
  3. 在用户名输入框输入有效用户名（如：`haylee5`）
  4. 在密码输入框输入正确密码（如：`Wh520520!`）
  5. 截图：输入凭据后
  6. 点击"登录"按钮
  7. 截图：点击登录后
  8. 等待页面跳转
  9. 截图：登录成功后的页面
- **预期结果**: 
  - 成功跳转到`/admin`页面
  - 显示用户信息（右上角用户菜单）
  - URL不包含`/Account/Login`
- **标签**: `@login`, `@P0`, `@functional`

#### TC-LOGIN-002: 使用有效邮箱和密码登录
- **优先级**: P0
- **前置条件**: 系统中存在有效用户邮箱
- **测试步骤**:
  1. 访问登录页面
  2. 截图：初始状态
  3. 在用户名输入框输入有效邮箱（如：`haylee5@test.com`）
  4. 在密码输入框输入正确密码
  5. 截图：输入凭据后
  6. 点击"登录"按钮
  7. 截图：登录成功后
- **预期结果**: 成功登录并跳转到dashboard
- **标签**: `@login`, `@P0`, `@functional`

#### TC-LOGIN-003: 记住我功能验证
- **优先级**: P1
- **前置条件**: 用户未登录
- **测试步骤**:
  1. 访问登录页面
  2. 截图：初始状态
  3. 输入有效凭据
  4. 勾选"记住我"复选框
  5. 截图：勾选记住我后
  6. 点击"登录"按钮
  7. 登录成功后，关闭浏览器
  8. 重新打开浏览器访问系统
  9. 截图：重新访问后的状态
- **预期结果**: 
  - 重新访问时仍然保持登录状态（或显示记住的用户名）
  - 会话cookie有效期延长
- **标签**: `@login`, `@P1`, `@functional`

#### TC-LOGIN-004: 显示/隐藏密码功能
- **优先级**: P2
- **前置条件**: 无
- **测试步骤**:
  1. 访问登录页面
  2. 截图：初始状态
  3. 在密码框输入密码（如：`Test123!@#`）
  4. 验证密码默认显示为掩码（如：`•••••••••`）
  5. 截图：密码掩码状态
  6. 点击密码框旁边的显示/隐藏按钮
  7. 截图：密码明文显示状态
  8. 验证密码显示为明文
  9. 再次点击按钮
  10. 截图：再次切换为掩码
- **预期结果**: 
  - 密码默认为掩码显示
  - 点击按钮后可切换显示/隐藏
  - 按钮图标随状态变化
- **标签**: `@login`, `@P2`, `@functional`, `@ui`

#### TC-LOGIN-005: 语言切换功能
- **优先级**: P2
- **前置条件**: 无
- **测试步骤**:
  1. 访问登录页面
  2. 截图：默认语言（简体中文）
  3. 点击语言切换器按钮
  4. 截图：语言列表展开
  5. 选择"English / EN"
  6. 截图：切换为英文后
  7. 验证页面文本变为英文
- **预期结果**: 
  - 语言切换成功
  - 所有UI文本按所选语言显示
- **标签**: `@login`, `@P2`, `@functional`, `@ui`

---

### 2.2 负面测试 (Negative Tests) - P1

#### TC-LOGIN-006: 使用无效用户名登录
- **优先级**: P1
- **前置条件**: 无
- **测试步骤**:
  1. 访问登录页面
  2. 截图：初始状态
  3. 输入不存在的用户名（如：`nonexistent_user_999`）
  4. 输入任意密码
  5. 截图：输入无效凭据后
  6. 点击"登录"按钮
  7. 截图：错误提示显示
- **预期结果**: 
  - 显示错误提示："Invalid username or password!"
  - 保持在登录页面
  - 输入框内容保留
- **标签**: `@login`, `@P1`, `@negative`

#### TC-LOGIN-007: 使用错误密码登录
- **优先级**: P1
- **前置条件**: 系统中存在有效用户
- **测试步骤**:
  1. 访问登录页面
  2. 截图：初始状态
  3. 输入有效用户名（如：`haylee5`）
  4. 输入错误密码（如：`WrongPassword123!`）
  5. 截图：输入错误密码后
  6. 点击"登录"按钮
  7. 截图：错误提示显示
- **预期结果**: 
  - 显示错误提示："Invalid username or password!"
  - 保持在登录页面
- **标签**: `@login`, `@P1`, `@negative`

#### TC-LOGIN-008: 使用不存在的邮箱登录
- **优先级**: P1
- **前置条件**: 无
- **测试步骤**:
  1. 访问登录页面
  2. 输入不存在的邮箱（如：`nonexistent@test.com`）
  3. 输入任意密码
  4. 截图：输入后
  5. 点击"登录"按钮
  6. 截图：错误提示
- **预期结果**: 显示错误提示
- **标签**: `@login`, `@P1`, `@negative`

#### TC-LOGIN-009: 用户名为空提交
- **优先级**: P1
- **前置条件**: 无
- **测试步骤**:
  1. 访问登录页面
  2. 截图：初始状态
  3. 用户名输入框保持为空
  4. 在密码框输入任意密码
  5. 截图：密码已填写，用户名为空
  6. 点击"登录"按钮
  7. 截图：验证错误显示
- **预期结果**: 
  - 显示HTML5必填字段验证提示
  - 或显示自定义错误提示："请填写此字段"
  - 不发送登录请求
- **标签**: `@login`, `@P1`, `@negative`, `@validation`

#### TC-LOGIN-010: 密码为空提交
- **优先级**: P1
- **前置条件**: 无
- **测试步骤**:
  1. 访问登录页面
  2. 截图：初始状态
  3. 输入有效用户名
  4. 密码框保持为空
  5. 截图：用户名已填写，密码为空
  6. 点击"登录"按钮
  7. 截图：验证错误显示
- **预期结果**: 
  - 显示HTML5必填字段验证提示
  - 不发送登录请求
- **标签**: `@login`, `@P1`, `@negative`, `@validation`

#### TC-LOGIN-011: 两个字段都为空提交
- **优先级**: P1
- **前置条件**: 无
- **测试步骤**:
  1. 访问登录页面
  2. 截图：初始状态（所有字段为空）
  3. 不填写任何内容，直接点击"登录"按钮
  4. 截图：验证错误显示
- **预期结果**: 
  - 显示用户名字段的必填验证提示
  - 不发送登录请求
- **标签**: `@login`, `@P1`, `@negative`, `@validation`

---

### 2.3 边界测试 (Boundary Tests) - P2

#### TC-LOGIN-012: 超长用户名输入
- **优先级**: P2
- **前置条件**: 无
- **测试步骤**:
  1. 访问登录页面
  2. 截图：初始状态
  3. 输入256个字符的用户名
  4. 输入有效密码
  5. 截图：超长输入后
  6. 点击"登录"按钮
  7. 截图：系统响应
- **预期结果**: 
  - 系统应优雅处理超长输入
  - 可能截断或显示错误提示
  - 不应导致系统崩溃
- **标签**: `@login`, `@P2`, `@boundary`

#### TC-LOGIN-013: 超长密码输入
- **优先级**: P2
- **前置条件**: 无
- **测试步骤**:
  1. 访问登录页面
  2. 输入有效用户名
  3. 输入256个字符的密码
  4. 截图：超长密码后
  5. 点击"登录"按钮
  6. 截图：系统响应
- **预期结果**: 系统应优雅处理
- **标签**: `@login`, `@P2`, `@boundary`

#### TC-LOGIN-014: 特殊字符用户名
- **优先级**: P2
- **前置条件**: 无
- **测试步骤**:
  1. 访问登录页面
  2. 输入包含特殊字符的用户名（如：`user<script>alert('xss')</script>`）
  3. 输入有效密码
  4. 截图：特殊字符输入后
  5. 点击"登录"按钮
  6. 截图：系统响应
- **预期结果**: 
  - 特殊字符应被正确转义
  - 不执行任何脚本代码
  - 显示登录失败提示
- **标签**: `@login`, `@P2`, `@boundary`, `@security`

#### TC-LOGIN-015: 特殊字符密码
- **优先级**: P2
- **前置条件**: 无
- **测试步骤**:
  1. 访问登录页面
  2. 输入有效用户名
  3. 输入包含特殊字符的密码（如：`Pass<>'"&123!`）
  4. 截图：特殊字符密码后
  5. 点击"登录"按钮
  6. 截图：系统响应
- **预期结果**: 特殊字符应被正确处理
- **标签**: `@login`, `@P2`, `@boundary`

---

### 2.4 UI测试 (UI Tests) - P2

#### TC-LOGIN-016: 页面加载验证
- **优先级**: P1
- **前置条件**: 无
- **测试步骤**:
  1. 访问登录页面
  2. 截图：页面完全加载后
  3. 验证页面标题显示为"登录"
  4. 验证所有关键元素可见
- **预期结果**: 
  - 页面标题正确显示
  - 所有表单元素可见且可交互
  - 无控制台错误
- **标签**: `@login`, `@P1`, `@ui`

#### TC-LOGIN-017: 响应式布局验证
- **优先级**: P2
- **前置条件**: 无
- **测试步骤**:
  1. 在桌面视口（1920x1080）访问登录页面
  2. 截图：桌面视图
  3. 切换到平板视口（768x1024）
  4. 截图：平板视图
  5. 切换到移动视口（375x667）
  6. 截图：移动视图
- **预期结果**: 
  - 各视口下布局自适应
  - 表单元素可用且易于交互
- **标签**: `@login`, `@P2`, `@ui`, `@responsive`

#### TC-LOGIN-018: 表单元素可见性验证
- **优先级**: P1
- **前置条件**: 无
- **测试步骤**:
  1. 访问登录页面
  2. 截图：完整页面
  3. 验证以下元素可见：
     - 用户名输入框
     - 密码输入框
     - 记住我复选框
     - 登录按钮
     - 注册链接
     - 忘记密码链接
     - 语言切换器
- **预期结果**: 所有元素可见且可交互
- **标签**: `@login`, `@P1`, `@ui`

#### TC-LOGIN-019: 链接跳转验证
- **优先级**: P1
- **前置条件**: 无
- **测试步骤**:
  1. 访问登录页面
  2. 截图：初始状态
  3. 点击"注册"链接
  4. 截图：跳转后的注册页面
  5. 验证URL变为`/Account/Register`
  6. 返回登录页面
  7. 点击"忘记密码？"链接
  8. 截图：跳转后的忘记密码页面
  9. 验证URL变为`/Account/ForgotPassword`
- **预期结果**: 
  - 链接正确跳转到目标页面
  - URL正确更新
- **标签**: `@login`, `@P1`, `@ui`, `@navigation`

---

### 2.5 安全测试 (Security Tests) - P1/P2

#### TC-LOGIN-020: SQL注入防护
- **优先级**: P1
- **前置条件**: 无
- **测试步骤**:
  1. 访问登录页面
  2. 在用户名输入框输入SQL注入payload（如：`admin' OR '1'='1`）
  3. 输入任意密码
  4. 截图：SQL注入尝试
  5. 点击"登录"按钮
  6. 截图：系统响应
- **预期结果**: 
  - 系统不执行SQL语句
  - 显示登录失败提示
  - 不泄露数据库信息
- **标签**: `@login`, `@P1`, `@security`

#### TC-LOGIN-021: XSS攻击防护
- **优先级**: P1
- **前置条件**: 无
- **测试步骤**:
  1. 访问登录页面
  2. 在用户名输入框输入XSS payload（如：`<script>alert('XSS')</script>`）
  3. 输入任意密码
  4. 截图：XSS尝试
  5. 点击"登录"按钮
  6. 截图：系统响应
- **预期结果**: 
  - 不执行JavaScript代码
  - 特殊字符被正确转义
  - 不弹出alert窗口
- **标签**: `@login`, `@P1`, `@security`

#### TC-LOGIN-022: 密码明文显示防护
- **优先级**: P1
- **前置条件**: 无
- **测试步骤**:
  1. 访问登录页面
  2. 输入密码
  3. 检查页面源代码
  4. 使用浏览器开发工具查看网络请求
  5. 截图：Network面板中的登录请求
- **预期结果**: 
  - 密码输入框type属性为"password"
  - 网络请求中密码应加密传输（HTTPS）
  - 页面源码中不存储明文密码
- **标签**: `@login`, `@P1`, `@security`

#### TC-LOGIN-023: 登录失败次数限制
- **优先级**: P2
- **前置条件**: 系统开启登录失败限制功能
- **测试步骤**:
  1. 访问登录页面
  2. 使用错误密码连续尝试登录5次
  3. 截图：每次失败后的提示
  4. 第6次尝试登录
  5. 截图：账号锁定提示
- **预期结果**: 
  - 多次失败后显示锁定提示
  - 或显示验证码
  - 或增加等待时间
- **标签**: `@login`, `@P2`, `@security`

---

## 3. 测试数据

### 3.1 有效测试数据
```json
{
  "valid_credentials": [
    {
      "username": "haylee5",
      "password": "Wh520520!",
      "expected_result": "登录成功"
    },
    {
      "username": "admin@aevatar.ai",
      "password": "Wh520520!",
      "expected_result": "登录成功"
    }
  ]
}
```

### 3.2 无效测试数据
```json
{
  "invalid_credentials": [
    {
      "username": "nonexistent_user",
      "password": "AnyPassword123!",
      "expected_error": "Invalid username or password!"
    },
    {
      "username": "haylee5",
      "password": "WrongPassword",
      "expected_error": "Invalid username or password!"
    }
  ]
}
```

### 3.3 边界测试数据
```json
{
  "boundary_data": [
    {
      "username": "a",
      "password": "Short1!",
      "description": "最短用户名"
    },
    {
      "username": "a".repeat(256),
      "password": "ValidPass123!",
      "description": "超长用户名"
    }
  ]
}
```

### 3.4 安全测试数据
```json
{
  "security_data": [
    {
      "username": "admin' OR '1'='1",
      "password": "anything",
      "attack_type": "SQL Injection"
    },
    {
      "username": "<script>alert('XSS')</script>",
      "password": "anything",
      "attack_type": "XSS"
    }
  ]
}
```

---

## 4. 测试执行策略

### 4.1 测试环境
- **浏览器**: Chromium (Playwright)
- **分辨率**: 1920x1080
- **测试服务器**: `https://localhost:44320`
- **前端服务器**: `https://localhost:3000`

### 4.2 测试执行顺序
1. P0功能测试（核心登录流程）
2. P1负面测试（错误处理）
3. P1安全测试（安全防护）
4. P2边界测试（极端情况）
5. P2 UI测试（用户界面）

### 4.3 自动化测试工具
- **框架**: Pytest
- **浏览器自动化**: Playwright
- **报告**: Allure Report
- **截图**: 关键步骤前后自动截图

### 4.4 测试通过标准
- 功能测试通过率：100%
- 负面测试通过率：100%
- 安全测试通过率：100%
- 边界测试通过率：≥90%
- UI测试通过率：≥95%

---

## 5. 风险和注意事项

### 5.1 已知风险
1. **SSL证书警告**: 测试环境使用自签名证书，需要在测试中忽略证书错误
2. **登录失败限制**: 如果系统开启了登录失败限制，需要在测试间等待或重置
3. **会话管理**: 测试间需要正确清理会话，避免干扰

### 5.2 注意事项
1. 每个测试用例关键步骤前后都需要截图
2. 使用class-scoped fixture共享登录会话，减少执行时间
3. 测试数据从JSON文件加载，保持灵活性
4. 失败的测试应自动截图，便于问题定位

---

## 6. 测试交付物

### 6.1 测试文档
- ✅ 测试计划（本文档）
- ⏳ Page Object: `tests/aevatar_station/pages/login_page.py`
- ⏳ 测试脚本: `tests/aevatar_station/test_login.py`
- ⏳ 测试数据: `tests/aevatar_station/test-data/login_data.json`

### 6.2 测试报告
- Allure HTML报告
- 测试截图（存储在`screenshots/`目录）
- 测试执行日志

---

**文档版本**: v1.0  
**创建日期**: 2025-01-06  
**最后更新**: 2025-01-06  
**作者**: HyperEcho AI Testing Team

