# 忘记密码功能测试计划

## 1. 测试概述

### 1.1 测试目标
验证Aevatar Station忘记密码功能的正确性和安全性，确保用户能够通过邮箱重置密码。

### 1.2 测试范围
- **页面URL**: `https://localhost:44320/Account/ForgotPassword`
- **测试类型**: 功能测试、验证测试、安全测试、UI测试
- **测试优先级**: P0（核心功能）、P1（重要功能）、P2（次要功能）

### 1.3 页面元素清单
通过Playwright MCP识别的关键页面元素：

| 元素 | 类型 | 选择器/名称 | 必填 |
|------|------|-------------|------|
| 页面标题 | heading | "忘记密码？" | - |
| 提示文本 | text | "您的电子邮件中将收到重置密码的链接..." | - |
| 电子邮件输入框 | textbox | "电子邮件 *" | 是 |
| 提交按钮 | button | "提交" | - |
| 返回登录链接 | link | "登录" | - |
| 语言切换器 | button | "简体中文" | - |

---

## 2. 测试用例

### 2.1 功能测试 - P0/P1

#### TC-FP-001: 使用有效邮箱提交忘记密码请求
- **优先级**: P0
- **前置条件**: 系统中存在有效用户邮箱
- **测试步骤**:
  1. 访问忘记密码页面
  2. 截图：页面初始状态
  3. 在邮箱输入框输入有效邮箱（如：`haylee5@test.com`）
  4. 截图：输入有效邮箱后
  5. 点击"提交"按钮
  6. 截图：提交处理中
  7. 等待页面响应
  8. 截图：成功提示消息
- **预期结果**: 
  - 显示"重置密码链接已发送到您的邮箱"提示
  - 或显示"如果该邮箱存在，您将收到重置链接"（防止邮箱枚举）
- **标签**: `@forgot_password`, `@P0`, `@functional`

#### TC-FP-002: 验证邮件发送成功提示
- **优先级**: P1
- **测试步骤**:
  1. 提交有效邮箱
  2. 截图：成功提示页面
  3. 验证提示消息内容和样式
  4. 验证是否显示"返回登录"按钮或链接
- **预期结果**: 
  - 显示友好的成功提示
  - 提供返回登录的途径
- **标签**: `@forgot_password`, `@P1`, `@functional`, `@ui`

#### TC-FP-003: 返回登录页面链接验证
- **优先级**: P2
- **测试步骤**:
  1. 访问忘记密码页面
  2. 截图：初始状态
  3. 点击"登录"链接
  4. 截图：跳转后的登录页面
  5. 验证URL变为`/Account/Login`
- **预期结果**: 成功跳转到登录页面
- **标签**: `@forgot_password`, `@P2`, `@navigation`

---

### 2.2 验证测试 - P1

#### TC-FP-004: 邮箱为空校验
- **优先级**: P1
- **测试步骤**:
  1. 访问忘记密码页面
  2. 截图：邮箱输入框为空
  3. 不输入任何内容，直接点击"提交"按钮
  4. 截图：验证错误提示
- **预期结果**: 
  - 显示HTML5必填字段验证提示
  - 或显示"请输入邮箱地址"错误消息
- **标签**: `@forgot_password`, `@P1`, `@validation`

#### TC-FP-005: 无效邮箱格式校验
- **优先级**: P1
- **测试步骤**:
  1. 访问忘记密码页面
  2. 输入无效邮箱格式（如：`invalid-email`）
  3. 截图：无效格式输入
  4. 点击"提交"按钮
  5. 截图：格式错误提示
- **预期结果**: 
  - 显示邮箱格式错误提示
  - 不发送请求到服务器
- **标签**: `@forgot_password`, `@P1`, `@validation`

#### TC-FP-006: 不存在的邮箱提交
- **优先级**: P1
- **测试步骤**:
  1. 访问忘记密码页面
  2. 输入不存在的邮箱地址（如：`nonexistent999@test.com`）
  3. 截图：输入不存在的邮箱
  4. 点击"提交"按钮
  5. 截图：系统响应
- **预期结果**: 
  - **推荐**：显示与存在邮箱相同的成功提示（防止邮箱枚举攻击）
  - 或显示"该邮箱未注册"错误（不推荐，存在安全风险）
- **标签**: `@forgot_password`, `@P1`, `@validation`, `@security`

---

### 2.3 边界测试 - P2

#### TC-FP-007: 超长邮箱地址
- **优先级**: P2
- **测试步骤**:
  1. 访问忘记密码页面
  2. 输入超长邮箱地址（如：254个字符）
  3. 截图：超长邮箱输入
  4. 点击"提交"按钮
  5. 截图：系统响应
- **预期结果**: 
  - 系统应优雅处理超长输入
  - 显示长度限制提示或自动截断
- **标签**: `@forgot_password`, `@P2`, `@boundary`

#### TC-FP-008: 最短有效邮箱
- **优先级**: P2
- **测试步骤**:
  1. 访问忘记密码页面
  2. 输入最短有效邮箱（如：`a@b.c`）
  3. 截图：最短邮箱输入
  4. 点击"提交"按钮
  5. 截图：系统响应
- **预期结果**: 
  - 格式验证通过
  - 显示提交成功提示
- **标签**: `@forgot_password`, `@P2`, `@boundary`

---

### 2.4 安全测试 - P1

#### TC-FP-009: 防止邮箱枚举攻击
- **优先级**: P1
- **测试步骤**:
  1. 提交存在的邮箱，记录响应时间和提示消息
  2. 截图：存在邮箱的响应
  3. 提交不存在的邮箱，记录响应时间和提示消息
  4. 截图：不存在邮箱的响应
  5. 对比两次响应的差异
- **预期结果**: 
  - 响应时间相似（误差≤100ms）
  - 提示消息相同或非常相似
  - 不泄露邮箱是否存在的信息
- **标签**: `@forgot_password`, `@P1`, `@security`

#### TC-FP-010: 限制频繁请求（防止邮件轰炸）
- **优先级**: P1
- **前置条件**: 系统开启速率限制功能
- **测试步骤**:
  1. 连续5次提交相同邮箱
  2. 截图：每次提交后的响应
  3. 第6次提交
  4. 截图：速率限制提示
- **预期结果**: 
  - 短时间内多次请求后显示"请稍后再试"提示
  - 或显示验证码
  - 或增加提交间隔时间
- **标签**: `@forgot_password`, `@P1`, `@security`

---

### 2.5 UI测试 - P1/P2

#### TC-FP-011: 页面加载验证
- **优先级**: P1
- **测试步骤**:
  1. 访问忘记密码页面
  2. 截图：页面完全加载后
  3. 验证页面标题为"忘记密码？"
  4. 验证提示文本可见
  5. 验证所有表单元素可见
- **预期结果**: 
  - 页面正确加载
  - 所有元素可见且可交互
  - 无控制台错误
- **标签**: `@forgot_password`, `@P1`, `@ui`

#### TC-FP-012: 提示信息显示验证
- **优先级**: P2
- **测试步骤**:
  1. 访问忘记密码页面
  2. 截图：提示信息区域
  3. 验证提示文本内容：
     - "您的电子邮件中将收到重置密码的链接"
     - "如果您在几分钟内没有收到电子邮件，请重试"
  4. 验证文本清晰易读
- **预期结果**: 
  - 提示信息完整显示
  - 文本内容准确
  - 排版美观
- **标签**: `@forgot_password`, `@P2`, `@ui`

---

## 3. 测试数据

### 3.1 有效邮箱数据
```json
{
  "valid_emails": [
    {
      "email": "haylee5@test.com",
      "exists_in_system": true,
      "expected_result": "成功提示"
    }
  ]
}
```

### 3.2 无效邮箱数据
```json
{
  "invalid_emails": [
    {
      "email": "",
      "error_type": "empty",
      "expected_error": "必填字段"
    },
    {
      "email": "invalid-email",
      "error_type": "format",
      "expected_error": "邮箱格式错误"
    },
    {
      "email": "test@",
      "error_type": "incomplete",
      "expected_error": "邮箱格式错误"
    },
    {
      "email": "nonexistent@test.com",
      "error_type": "not_exists",
      "expected_error": "通用成功提示（推荐）"
    }
  ]
}
```

### 3.3 边界测试数据
```json
{
  "boundary_data": [
    {
      "email": "a@b.c",
      "description": "最短有效邮箱"
    },
    {
      "email": "very_long_email_address_" + "a".repeat(220) + "@test.com",
      "description": "超长邮箱（254字符）"
    }
  ]
}
```

---

## 4. 测试执行策略

### 4.1 测试环境
- **浏览器**: Chromium (Playwright)
- **测试服务器**: `https://localhost:44320`
- **截图策略**: 关键步骤前后自动截图

### 4.2 测试执行顺序
1. P0功能测试（核心重置密码流程）
2. P1验证测试（输入验证）
3. P1安全测试（防护机制）
4. P2边界测试（极端情况）
5. P2 UI测试（用户界面）

### 4.3 测试通过标准
- P0功能测试通过率：100%
- P1验证测试通过率：100%
- P1安全测试通过率：100%
- P2边界测试通过率：≥90%
- P2 UI测试通过率：≥95%

---

## 5. 风险和注意事项

### 5.1 已知风险
1. **邮件发送功能**: 测试环境可能未配置SMTP服务器，邮件可能无法实际发送
2. **速率限制**: 测试速率限制功能时可能被系统暂时封禁
3. **邮箱枚举**: 需要特别关注是否泄露邮箱存在性信息

### 5.2 注意事项
1. 测试时使用测试邮箱，避免影响真实用户
2. 验证速率限制功能时注意时间间隔
3. 安全测试用例需要特别关注响应细节

---

## 6. 测试交付物

### 6.1 测试文档
- ✅ 测试计划（本文档）
- ⏳ Page Object: `tests/aevatar_station/pages/forgot_password_page.py`
- ⏳ 测试脚本: `tests/aevatar_station/test_forgot_password.py`
- ⏳ 测试数据: 使用现有的`login_data.json`或新建专用文件

### 6.2 测试报告
- Allure HTML报告
- 测试截图（存储在`screenshots/`目录）
- 测试执行日志

---

**文档版本**: v1.0  
**创建日期**: 2025-01-06  
**作者**: HyperEcho AI Testing Team

