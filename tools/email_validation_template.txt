    @pytest.mark.P1
    @pytest.mark.validation
    def test_p1_email_field_format_validation(self, logged_in_profile_page):
        """
        TC-VALID-EMAIL-001: Emailå­—æ®µæ ¼å¼ä¸é•¿åº¦éªŒè¯æµ‹è¯•ï¼ˆå®Œæ•´ç‰ˆï¼‰
        
        æµ‹è¯•ç›®æ ‡ï¼šéªŒè¯Emailå­—æ®µçš„å®Œæ•´éªŒè¯è§„åˆ™ï¼ˆæ ¼å¼+é•¿åº¦+å¿…å¡«ï¼‰
        æµ‹è¯•åŒºåŸŸï¼šProfile - Personal Settings - Email Validation
        
        ============================================================================
        åç«¯æ ¡éªŒè§„åˆ™ï¼ˆABP Framework AbpUserConstsï¼‰:
        ============================================================================
        
        ğŸ“‹ å­—æ®µå±æ€§
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  å­—æ®µåï¼šEmail                                                    â”‚
        â”‚  å¿…å¡«çŠ¶æ€ï¼šâœ… å¿…å¡«ï¼ˆåç«¯å¼ºåˆ¶éªŒè¯ï¼‰                               â”‚
        â”‚  å¯ç¼–è¾‘æ€§ï¼šâœ… å¯ç¼–è¾‘                                             â”‚
        â”‚  é•¿åº¦é™åˆ¶ï¼š3-256å­—ç¬¦                                             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        
        ğŸ”¤ æ ¼å¼è§„åˆ™
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  æ­£åˆ™è¡¨è¾¾å¼ï¼š^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$   â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚  âœ… å¿…é¡»åŒ…å«ï¼š                                                    â”‚
        â”‚     â€¢ @ç¬¦å·ï¼ˆå¿…é¡»æœ‰ä¸”åªæœ‰ä¸€ä¸ªï¼‰                                  â”‚
        â”‚     â€¢ @å‰çš„ç”¨æˆ·åéƒ¨åˆ†                                            â”‚
        â”‚     â€¢ @åçš„åŸŸåéƒ¨åˆ†                                              â”‚
        â”‚     â€¢ é¡¶çº§åŸŸåï¼ˆ.com, .orgç­‰ï¼‰                                   â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚  âŒ ä¸å…è®¸ï¼š                                                      â”‚
        â”‚     â€¢ ç¼ºå°‘@ç¬¦å·                                                   â”‚
        â”‚     â€¢ ç¼ºå°‘ç”¨æˆ·å                                                  â”‚
        â”‚     â€¢ ç¼ºå°‘åŸŸå                                                    â”‚
        â”‚     â€¢ ç¼ºå°‘é¡¶çº§åŸŸå                                                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        
        ğŸ“ æµ‹è¯•åœºæ™¯è¦†ç›–ï¼ˆ15ä¸ªåœºæ™¯ï¼‰
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  1. æ ¼å¼éªŒè¯-æœ‰æ•ˆï¼ˆ5ä¸ªåœºæ™¯ï¼‰                                      â”‚
        â”‚     â€¢ æ ‡å‡†é‚®ç®±ï¼šuser@example.com                                  â”‚
        â”‚     â€¢ å¸¦ç‚¹ç”¨æˆ·åï¼šuser.name@example.com                           â”‚
        â”‚     â€¢ å¸¦åŠ å·ï¼šuser+tag@example.com                                â”‚
        â”‚     â€¢ å­åŸŸåï¼štest@sub.example.org                                â”‚
        â”‚     â€¢ å¸¦æ•°å­—ï¼šuser123@domain456.com                               â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚  2. æ ¼å¼éªŒè¯-æ— æ•ˆï¼ˆ3ä¸ªåœºæ™¯ï¼‰                                      â”‚
        â”‚     â€¢ ç¼ºå°‘@ï¼šinvalidemail.com                                     â”‚
        â”‚     â€¢ ç¼ºå°‘åŸŸåï¼štest@                                             â”‚
        â”‚     â€¢ ç¼ºå°‘ç”¨æˆ·åï¼š@example.com                                    â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚  3. é•¿åº¦éªŒè¯ï¼ˆ5ä¸ªåœºæ™¯ï¼‰                                           â”‚
        â”‚     â€¢ æœ€å°é•¿åº¦3å­—ç¬¦ï¼ša@b                                          â”‚
        â”‚     â€¢ æ­£å¸¸é•¿åº¦ï¼šuser@example.com                                  â”‚
        â”‚     â€¢ æœ€å¤§é•¿åº¦256å­—ç¬¦ï¼šæ„é€ çš„æé•¿é‚®ç®±                             â”‚
        â”‚     â€¢ è¶…é•¿257å­—ç¬¦ï¼šåº”è¢«æ‹’ç»                                       â”‚
        â”‚     â€¢ æé•¿300å­—ç¬¦ï¼šåº”è¢«æ‹’ç»                                       â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚  4. è¾¹ç•Œæƒ…å†µï¼ˆ1ä¸ªåœºæ™¯ï¼‰                                           â”‚
        â”‚     â€¢ ç¼ºå°‘é¡¶çº§åŸŸåï¼štest@exampleï¼ˆHTML5å¯èƒ½æ¥å—ï¼Œåç«¯åº”æ‹’ç»ï¼‰    â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚  5. å¿…å¡«éªŒè¯ï¼ˆ1ä¸ªåœºæ™¯ï¼‰                                           â”‚
        â”‚     â€¢ ç©ºå€¼ï¼šåº”è§¦å‘å¿…å¡«éªŒè¯é”™è¯¯                                    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        
        é¢„æœŸç»“æœï¼š
        - æœ‰æ•ˆæ ¼å¼é€šè¿‡éªŒè¯ï¼ŒæˆåŠŸä¿å­˜
        - æ— æ•ˆæ ¼å¼è§¦å‘HTML5éªŒè¯é”™è¯¯ï¼Œé˜»æ­¢ä¿å­˜
        - è¶…é•¿è¾“å…¥è¢«æ‹’ç»æˆ–æˆªæ–­
        - ç©ºå€¼è§¦å‘å¿…å¡«éªŒè¯
        - æ‰€æœ‰é”™è¯¯åœºæ™¯éƒ½æœ‰æ˜ç¡®çš„é”™è¯¯æç¤º
        """
        logger.info("å¼€å§‹æ‰§è¡ŒTC-VALID-EMAIL-001: Emailå­—æ®µæ ¼å¼ä¸é•¿åº¦éªŒè¯")
        logger.info("=" * 60)
        logger.info("æ ¡éªŒè§„åˆ™ï¼šMinEmailLength=3, MaxEmailLength=256, å¿…å¡«, éœ€è¦æœ‰æ•ˆé‚®ç®±æ ¼å¼")
        logger.info("=" * 60)
        
        profile_page = logged_in_profile_page
        screenshot_idx = 1
        
        # è·å–åŸå§‹Email
        original_email = profile_page.get_email_value()
        logger.info(f"åŸå§‹Email: {original_email}")
        
        # æˆªå›¾1ï¼šåˆå§‹çŠ¶æ€
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        screenshot_path = f"email_validation_init_{timestamp}.png"
        profile_page.take_screenshot(screenshot_path)
        allure.attach.file(
            f"screenshots/{screenshot_path}",
            name=f"{screenshot_idx}-Emailå­—æ®µåˆå§‹çŠ¶æ€",
            attachment_type=allure.attachment_type.PNG
        )
        screenshot_idx += 1
        
        # å®šä¹‰æµ‹è¯•åœºæ™¯ï¼ˆå®Œæ•´è¦†ç›–15ä¸ªåœºæ™¯ï¼‰
        test_scenarios = [
            # ========== 1. æ ¼å¼éªŒè¯-æœ‰æ•ˆï¼ˆ5ä¸ªåœºæ™¯ï¼‰ ==========
            {
                "type": "format_valid",
                "name": "æ ‡å‡†é‚®ç®±",
                "value": f"user{datetime.now().strftime('%H%M%S')}@example.com",
                "should_save": True,
                "should_error": False,
                "description": "æ ‡å‡†é‚®ç®±æ ¼å¼ï¼ˆæœ‰æ•ˆï¼‰",
                "expected": "æˆåŠŸä¿å­˜",
            },
            {
                "type": "format_valid",
                "name": "å¸¦ç‚¹ç”¨æˆ·å",
                "value": f"user.name{datetime.now().strftime('%H%M%S')}@example.com",
                "should_save": True,
                "should_error": False,
                "description": "ç”¨æˆ·ååŒ…å«ç‚¹ï¼ˆæœ‰æ•ˆï¼‰",
                "expected": "æˆåŠŸä¿å­˜",
            },
            {
                "type": "format_valid",
                "name": "å¸¦åŠ å·",
                "value": f"user+tag{datetime.now().strftime('%H%M%S')}@example.com",
                "should_save": True,
                "should_error": False,
                "description": "ç”¨æˆ·ååŒ…å«åŠ å·ï¼ˆæœ‰æ•ˆï¼‰",
                "expected": "æˆåŠŸä¿å­˜",
            },
            {
                "type": "format_valid",
                "name": "å­åŸŸå",
                "value": f"test{datetime.now().strftime('%H%M%S')}@sub.example.org",
                "should_save": True,
                "should_error": False,
                "description": "åŒ…å«å­åŸŸåï¼ˆæœ‰æ•ˆï¼‰",
                "expected": "æˆåŠŸä¿å­˜",
            },
            {
                "type": "format_valid",
                "name": "å¸¦æ•°å­—",
                "value": f"user123@domain456.com",
                "should_save": True,
                "should_error": False,
                "description": "ç”¨æˆ·åå’ŒåŸŸåéƒ½åŒ…å«æ•°å­—ï¼ˆæœ‰æ•ˆï¼‰",
                "expected": "æˆåŠŸä¿å­˜",
            },
            
            # ========== 2. æ ¼å¼éªŒè¯-æ— æ•ˆï¼ˆ3ä¸ªåœºæ™¯ï¼‰ ==========
            {
                "type": "format_invalid",
                "name": "ç¼ºå°‘@ç¬¦å·",
                "value": "invalidemail.com",
                "should_save": False,
                "should_error": True,
                "description": "ç¼ºå°‘@ç¬¦å·ï¼ˆæ— æ•ˆï¼‰",
                "expected": "ä¿å­˜å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯",
            },
            {
                "type": "format_invalid",
                "name": "ç¼ºå°‘åŸŸå",
                "value": "test@",
                "should_save": False,
                "should_error": True,
                "description": "ç¼ºå°‘åŸŸåéƒ¨åˆ†ï¼ˆæ— æ•ˆï¼‰",
                "expected": "ä¿å­˜å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯",
            },
            {
                "type": "format_invalid",
                "name": "ç¼ºå°‘ç”¨æˆ·å",
                "value": "@example.com",
                "should_save": False,
                "should_error": True,
                "description": "ç¼ºå°‘ç”¨æˆ·åéƒ¨åˆ†ï¼ˆæ— æ•ˆï¼‰",
                "expected": "ä¿å­˜å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯",
            },
            
            # ========== 3. é•¿åº¦éªŒè¯ï¼ˆ5ä¸ªåœºæ™¯ï¼‰ ==========
            {
                "type": "length_min",
                "name": "æœ€å°é•¿åº¦3å­—ç¬¦",
                "value": "a@b",
                "should_save": True,  # HTML5å¯èƒ½æ¥å—ï¼Œä½†ABP MinEmailLength=3
                "should_error": False,
                "description": "æœ€å°æœ‰æ•ˆé•¿åº¦ï¼ˆè¾¹ç•Œå€¼ï¼‰",
                "expected": "æˆåŠŸä¿å­˜æˆ–è¢«æ‹’ç»",
            },
            {
                "type": "length_normal",
                "name": "æ­£å¸¸é•¿åº¦",
                "value": f"normaluser{datetime.now().strftime('%H%M%S')}@example.com",
                "should_save": True,
                "should_error": False,
                "description": "æ­£å¸¸é•¿åº¦é‚®ç®±",
                "expected": "æˆåŠŸä¿å­˜",
            },
            {
                "type": "length_max",
                "name": "æœ€å¤§é•¿åº¦256å­—ç¬¦",
                "value": "u" * 240 + "@example.com",  # 240+12=252å­—ç¬¦ï¼ˆç•¥å°äº256ï¼‰
                "should_save": True,
                "should_error": False,
                "description": "æ¥è¿‘æœ€å¤§é•¿åº¦ï¼ˆè¾¹ç•Œå€¼ï¼‰",
                "expected": "æˆåŠŸä¿å­˜",
            },
            {
                "type": "length_over",
                "name": "è¶…é•¿257å­—ç¬¦",
                "value": "x" * 245 + "@example.com",  # 245+12=257å­—ç¬¦
                "should_save": False,
                "should_error": True,
                "description": "è¶…è¿‡æœ€å¤§é•¿åº¦ï¼ˆè¾¹ç•Œå€¼+1ï¼‰",
                "expected": "è¢«æˆªæ–­æˆ–æ˜¾ç¤ºé”™è¯¯",
            },
            {
                "type": "length_over",
                "name": "æé•¿300å­—ç¬¦",
                "value": "z" * 288 + "@example.com",  # 288+12=300å­—ç¬¦
                "should_save": False,
                "should_error": True,
                "description": "è¿œè¶…æœ€å¤§é•¿åº¦",
                "expected": "è¢«æˆªæ–­æˆ–æ˜¾ç¤ºé”™è¯¯",
            },
            
            # ========== 4. è¾¹ç•Œæƒ…å†µï¼ˆ1ä¸ªåœºæ™¯ï¼‰ ==========
            {
                "type": "format_boundary",
                "name": "ç¼ºå°‘é¡¶çº§åŸŸå",
                "value": "test@example",
                "should_save": False,  # ç”¨æˆ·è¦æ±‚æ”¹ä¸ºFalse
                "should_error": False,  # HTML5å¯èƒ½æ¥å—ï¼Œä½†ä¸æ˜¯æ ‡å‡†æ ¼å¼
                "description": "ç¼ºå°‘é¡¶çº§åŸŸåï¼ˆHTML5å¯èƒ½æ¥å—ï¼‰",
                "expected": "HTML5å¯èƒ½æ¥å—ï¼Œåç«¯å¯èƒ½æ‹’ç»",
            },
            
            # ========== 5. å¿…å¡«éªŒè¯ï¼ˆ1ä¸ªåœºæ™¯ï¼‰ ==========
            {
                "type": "required_empty",
                "name": "ç©ºå€¼éªŒè¯",
                "value": "",
                "should_save": False,
                "should_error": True,
                "description": "ç©ºå€¼ï¼ˆå¿…å¡«å­—æ®µï¼‰",
                "expected": "æ˜¾ç¤ºå¿…å¡«é”™è¯¯",
            },
        ]
        
        validation_results = []
        
        # æ‰§è¡Œæµ‹è¯•åœºæ™¯
        for idx, scenario in enumerate(test_scenarios, 1):
            logger.info("")
            logger.info("=" * 70)
            logger.info(f"åœºæ™¯ {idx}/{len(test_scenarios)}: {scenario['name']}")
            logger.info("=" * 70)
            logger.info(f"  è¾“å…¥å€¼: '{scenario['value'][:50]}{'...' if len(scenario['value']) > 50 else ''}'")
            logger.info(f"  é•¿åº¦: {len(scenario['value'])} å­—ç¬¦")
            logger.info(f"  æè¿°: {scenario['description']}")
            logger.info(f"  é¢„æœŸ: {scenario['expected']}")
            
            # åˆ·æ–°é¡µé¢ç¡®ä¿å¹²å‡€çŠ¶æ€
            profile_page.page.reload()
            profile_page.page.wait_for_load_state("domcontentloaded")
            profile_page.page.wait_for_timeout(2000)
            
            # è¾“å…¥æµ‹è¯•å€¼
            profile_page.fill_input(profile_page.EMAIL_INPUT, scenario['value'])
            
            # æˆªå›¾1ï¼šè¾“å…¥å
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            safe_name = scenario['name'].replace(' ', '_').replace('/', '_').replace('@', 'at')
            screenshot_path = f"email_{safe_name}_input_{timestamp}.png"
            profile_page.take_screenshot(screenshot_path)
            allure.attach.file(
                f"screenshots/{screenshot_path}",
                name=f"{screenshot_idx}-{scenario['name']}_è¾“å…¥å",
                attachment_type=allure.attachment_type.PNG
            )
            screenshot_idx += 1
            
            # ç‚¹å‡»ä¿å­˜
            profile_page.click_element(profile_page.SAVE_BUTTON)
            profile_page.page.wait_for_load_state("networkidle")
            profile_page.page.wait_for_timeout(2000)
            
            # æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯æç¤º
            has_error = False
            error_message = ""
            try:
                # æ£€æŸ¥HTML5éªŒè¯é”™è¯¯
                validation_info = profile_page.page.evaluate(f"""
                    (() => {{
                        const el = document.querySelector("{profile_page.EMAIL_INPUT}");
                        return {{
                            valid: el ? el.validity.valid : null,
                            message: el ? el.validationMessage : '',
                            valueMissing: el ? el.validity.valueMissing : null,
                            typeMismatch: el ? el.validity.typeMismatch : null,
                            tooLong: el ? el.validity.tooLong : null,
                        }};
                    }})()
                """)
                
                if validation_info and not validation_info['valid']:
                    has_error = True
                    error_message = validation_info['message']
                    logger.info(f"  âœ“ æ£€æµ‹åˆ°HTML5éªŒè¯é”™è¯¯: {error_message}")
                
                # æ£€æŸ¥é¡µé¢é”™è¯¯æç¤º
                error_selectors = [".invalid-feedback", ".text-danger", "[role='alert'].text-danger"]
                for selector in error_selectors:
                    if profile_page.is_visible(selector):
                        error_text = profile_page.get_text(selector)
                        if error_text:
                            has_error = True
                            error_message += f" | {error_text}"
                            logger.info(f"  âœ“ æ£€æµ‹åˆ°é¡µé¢é”™è¯¯æç¤º: {error_text}")
            except Exception as e:
                logger.warning(f"  æ£€æŸ¥é”™è¯¯æ—¶å‡ºç°å¼‚å¸¸: {e}")
            
            # æˆªå›¾2ï¼šä¿å­˜åï¼ˆå¸¦é”™è¯¯æ£€æŸ¥ï¼‰
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            screenshot_path = f"email_{safe_name}_saved_{timestamp}.png"
            profile_page.take_screenshot(screenshot_path)
            
            # ç”Ÿæˆæˆªå›¾æè¿°ï¼ˆç»Ÿä¸€æ ¼å¼ï¼šé¢„æœŸ:X, å®é™…:Yï¼‰
            expected_str = "æˆåŠŸ" if scenario['should_save'] else "å¤±è´¥"
            actual_str = "æˆåŠŸ" if not has_error else "å¤±è´¥"
            error_expected_str = "æ— é”™è¯¯" if not scenario['should_error'] else "æœ‰é”™è¯¯"
            error_actual_str = "æ— é”™è¯¯" if not has_error else "æœ‰é”™è¯¯"
            
            screenshot_desc = f"{screenshot_idx}-{scenario['name']}_ä¿å­˜åï¼ˆé¢„æœŸ:{expected_str}/{error_expected_str}, å®é™…:{actual_str}/{error_actual_str}ï¼‰"
            
            allure.attach.file(
                f"screenshots/{screenshot_path}",
                name=screenshot_desc,
                attachment_type=allure.attachment_type.PNG
            )
            screenshot_idx += 1
            
            # åˆ·æ–°éªŒè¯
            profile_page.page.reload()
            profile_page.page.wait_for_load_state("domcontentloaded")
            profile_page.page.wait_for_timeout(2000)
            
            # è·å–ä¿å­˜åçš„å€¼
            saved_value = profile_page.get_email_value()
            is_saved = saved_value == scenario['value']
            
            # åˆ¤æ–­ç»“æœ
            save_match = is_saved == scenario['should_save']
            error_match = has_error == scenario['should_error']
            overall_match = save_match and error_match
            
            # è®°å½•ç»“æœ
            logger.info(f"")
            logger.info(f"  å®é™…ç»“æœ:")
            logger.info(f"    - ä¿å­˜çŠ¶æ€: {'æˆåŠŸä¿å­˜' if is_saved else 'æœªä¿å­˜/è¢«ä¿®æ”¹'}")
            logger.info(f"    - ä¿å­˜å€¼: '{saved_value[:50]}{'...' if len(saved_value) > 50 else ''}'")
            logger.info(f"    - é”™è¯¯æç¤º: {'æœ‰' if has_error else 'æ— '} {f'({error_message})' if error_message else ''}")
            logger.info(f"")
            logger.info(f"  ç»“æœåˆ¤æ–­:")
            logger.info(f"    - ä¿å­˜é¢„æœŸ: {scenario['should_save']}ï¼Œå®é™…: {is_saved}ï¼Œ{'âœ…åŒ¹é…' if save_match else 'âŒä¸åŒ¹é…'}")
            logger.info(f"    - é”™è¯¯é¢„æœŸ: {scenario['should_error']}ï¼Œå®é™…: {has_error}ï¼Œ{'âœ…åŒ¹é…' if error_match else 'âŒä¸åŒ¹é…'}")
            logger.info(f"    - ç»¼åˆç»“æœ: {'âœ… é€šè¿‡' if overall_match else 'âŒ å¤±è´¥'}")
            
            # å¦‚æœæ˜¯æ— æ•ˆåœºæ™¯ä½†æ²¡æœ‰é”™è¯¯æç¤ºï¼Œæ ‡è®°ä¸ºå‰ç«¯bug
            if scenario['should_error'] and not has_error:
                logger.error(f"  âš ï¸ å‰ç«¯BUGï¼šæ— æ•ˆè¾“å…¥æœªæ˜¾ç¤ºé”™è¯¯æç¤ºï¼")
            
            validation_results.append({
                "scenario": scenario['name'],
                "type": scenario['type'],
                "input": scenario['value'],
                "input_length": len(scenario['value']),
                "saved": saved_value,
                "saved_length": len(saved_value) if saved_value else 0,
                "expected_save": scenario['should_save'],
                "actually_saved": is_saved,
                "expected_error": scenario['should_error'],
                "actually_error": has_error,
                "error_message": error_message,
                "match": overall_match
            })
        
        # æ¢å¤åŸå§‹Email
        logger.info("")
        logger.info("=" * 70)
        logger.info(f"æ¢å¤åŸå§‹Email: '{original_email}'")
        logger.info("=" * 70)
        profile_page.page.reload()
        profile_page.page.wait_for_load_state("domcontentloaded")
        profile_page.page.wait_for_timeout(2000)
        profile_page.fill_input(profile_page.EMAIL_INPUT, original_email)
        profile_page.click_element(profile_page.SAVE_BUTTON)
        profile_page.page.wait_for_load_state("networkidle")
        profile_page.page.wait_for_timeout(2000)
        
        # è¾“å‡ºæµ‹è¯•ç»“æœæ±‡æ€»
        logger.info("")
        logger.info("=" * 80)
        logger.info("Emailå­—æ®µéªŒè¯ç»“æœæ±‡æ€»")
        logger.info("=" * 80)
        logger.info("| åœºæ™¯ | ç±»å‹ | é•¿åº¦ | ä¿å­˜é¢„æœŸ | ä¿å­˜å®é™… | é”™è¯¯é¢„æœŸ | é”™è¯¯å®é™… | ç»“æœ |")
        logger.info("|------|------|------|----------|----------|----------|----------|------|")
        for r in validation_results:
            scenario_short = r['scenario'][:15]
            type_short = r['type'].split('_')[0][:6]
            save_exp = "âœ“" if r['expected_save'] else "âœ—"
            save_act = "âœ“" if r['actually_saved'] else "âœ—"
            err_exp = "âœ“" if r['expected_error'] else "âœ—"
            err_act = "âœ“" if r['actually_error'] else "âœ—"
            result = "âœ…" if r['match'] else "âŒ"
            logger.info(f"| {scenario_short:15} | {type_short:6} | {r['input_length']:4} | {save_exp:8} | {save_act:8} | {err_exp:8} | {err_act:8} | {result:4} |")
        
        # ç»Ÿè®¡é€šè¿‡ç‡
        passed = sum(1 for r in validation_results if r['match'])
        total = len(validation_results)
        pass_rate = (passed / total * 100) if total > 0 else 0
        
        logger.info("")
        logger.info(f"æ€»ä½“é€šè¿‡ç‡: {passed}/{total} ({pass_rate:.1f}%)")
        logger.info("=" * 80)
        
        logger.info("TC-VALID-EMAIL-001æ‰§è¡Œå®Œæˆ")

