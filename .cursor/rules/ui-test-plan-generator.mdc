# UI自动化测试计划生成规则

## 规则概述
当用户提供一个网页链接时，自动使用Playwright MCP工具解析页面，并生成详细的UI自动化测试计划，保存到 @doc/test-case.md 文件中。

## 触发条件
- 用户消息包含HTTP/HTTPS链接
- 用户明确要求生成测试计划
- 用户提到"测试用例"、"自动化测试"、"UI测试"等关键词

## 执行步骤

### 1. 页面解析阶段
使用以下Playwright MCP工具按顺序执行：

1. **导航到页面**
   ```
   mcp_playwright-mcp-server_playwright_navigate
   - url: 用户提供的链接
   - headless: false (方便调试)
   - width: 1920
   - height: 1080
   ```

2. **获取页面HTML结构**
   ```
   mcp_playwright-mcp-server_playwright_get_visible_html
   - cleanHtml: true
   - removeScripts: true
   - removeStyles: false
   - maxLength: 20000
   ```

3. **截取页面截图**
   ```
   mcp_playwright-mcp-server_playwright_screenshot
   - name: "page_analysis"
   - fullPage: true
   - savePng: true
   ```

4. **获取页面文本内容**
   ```
   mcp_playwright-mcp-server_playwright_get_visible_text
   ```

### 2. 测试计划生成阶段

基于解析结果，生成包含以下内容的测试计划：

#### 2.1 页面基本信息
- 页面标题和URL
- 页面类型识别（登录页、列表页、详情页等）
- 主要功能模块识别

#### 2.2 UI元素分析
- **表单元素**：输入框、下拉框、按钮等
- **导航元素**：菜单、链接、面包屑等
- **展示元素**：表格、列表、卡片等
- **交互元素**：弹窗、标签页、手风琴等

#### 2.3 测试用例规划 - 全面测试点覆盖 ⭐
为每个功能模块生成全面的测试用例，必须覆盖以下维度：

##### 2.3.1 功能测试用例（必须）
- **正向流程**：正常业务流程的完整验证
- **关键功能**：核心业务功能的详细测试
- **功能组合**：多个功能配合使用的场景
- **数据流转**：数据在页面间的传递和显示

##### 2.3.2 边界测试用例（必须）
- **输入长度边界**：
  - 空值测试（0个字符）
  - 最小值测试（1个字符）
  - 最大值测试（达到限制）
  - 超长值测试（超过限制）
- **数字边界**：
  - 负数、零、正数
  - 最小值、最大值
  - 小数精度
- **特殊字符**：
  - 空格、制表符、换行符
  - 特殊符号（@#$%^&*）
  - Unicode字符、Emoji

##### 2.3.3 异常测试用例（必须）
- **输入异常**：
  - 空输入、null值
  - 错误格式数据
  - SQL注入尝试
  - XSS脚本注入
- **操作异常**：
  - 重复提交
  - 快速连续点击
  - 未完成操作就跳转
- **环境异常**：
  - 网络中断
  - 超时处理
  - 权限不足
  - 会话过期

##### 2.3.4 兼容性测试用例（推荐）
- **浏览器兼容**：Chrome、Firefox、Safari、Edge
- **分辨率测试**：1920x1080、1366x768、移动端分辨率
- **响应式测试**：桌面、平板、手机视图
- **操作系统**：Windows、macOS、Linux

##### 2.3.5 用户体验测试用例（推荐）
- **交互反馈**：
  - 按钮点击反馈
  - 加载状态提示
  - 操作成功/失败提示
- **页面布局**：
  - 元素对齐
  - 样式一致性
  - 滚动行为
- **可访问性**：
  - 键盘导航
  - Tab顺序
  - 焦点管理
  - 屏幕阅读器支持

##### 2.3.6 安全性测试用例（推荐）
- **输入安全**：
  - XSS防护验证
  - SQL注入防护
  - CSRF防护
- **数据安全**：
  - 敏感数据脱敏
  - 密码不可见
  - 安全传输（HTTPS）
- **权限控制**：
  - 未登录访问限制
  - 角色权限验证
  - 越权操作防护

##### 2.3.7 性能测试用例（推荐）
- **页面加载**：
  - 首次加载时间（< 3秒）
  - 后续加载时间
  - 资源加载顺序
- **操作响应**：
  - 点击响应时间（< 200ms）
  - 表单提交时间
  - 数据渲染时间
- **并发处理**：
  - 多标签页同时操作
  - 高频率操作

##### 2.3.8 数据一致性测试用例（必须）
- **显示一致性**：页面显示与数据库数据一致
- **状态一致性**：前后端状态同步
- **缓存一致性**：缓存数据与实时数据同步
- **跨页面一致性**：相同数据在不同页面显示一致

#### 2.4 页面对象模型设计
基于我们的框架结构 @pages/base_page.py，设计：
- 页面类名和继承关系
- 元素定位器定义
- 页面操作方法定义

#### 2.5 测试数据规划
参考 @test_data/login_data.json 格式：
- 有效数据集
- 无效数据集
- 边界数据集

### 3. 文档生成规则

生成的测试计划文档应包含：

```markdown
# [页面名称] UI自动化测试计划

## 1. 页面概述
- **URL**: [页面链接]
- **页面类型**: [页面类型]
- **主要功能**: [功能描述]
- **测试优先级**: [高/中/低]

## 2. 页面元素映射
### 2.1 关键元素识别
| 元素类型 | 元素描述 | 定位策略 | 定位器 |
|---------|----------|----------|--------|
| 输入框 | 用户名输入 | ID | #username |
| 按钮 | 登录按钮 | ID | #login-btn |

### 2.2 页面对象设计
```python
class [PageName]Page(BasePage):
    # 元素定位器
    ELEMENT_SELECTOR = "#element"
    
    def navigate(self):
        # 导航逻辑
        pass
    
    def is_loaded(self):
        # 页面加载检查
        pass
```

## 3. 测试用例设计
### 3.1 功能测试用例
- **TC001**: [测试用例名称]
  - **前置条件**: [条件描述]
  - **测试步骤**: [步骤列表]
  - **预期结果**: [结果描述]
  - **优先级**: [P0/P1/P2]
  - **测试类型**: [功能/边界/异常/兼容性/安全/性能/UX/数据一致性]

### 3.2 边界测试用例
包含输入长度边界、数字边界、特殊字符边界测试

### 3.3 异常测试用例
包含输入异常、操作异常、环境异常测试

### 3.4 兼容性测试用例
包含浏览器、分辨率、操作系统兼容性测试

### 3.5 用户体验测试用例
包含交互反馈、页面布局、可访问性测试

### 3.6 安全性测试用例
包含输入安全、数据安全、权限控制测试

### 3.7 性能测试用例
包含页面加载、操作响应、并发处理测试

### 3.8 数据一致性测试用例
包含显示一致性、状态一致性、缓存一致性测试

## 4. 测试数据设计
```json
{
  "valid_data": [
    {
      "field1": "value1",
      "field2": "value2"
    }
  ],
  "invalid_data": [
    {
      "field1": "",
      "field2": "invalid"
    }
  ]
}
```

## 5. 自动化实现建议
### 5.1 页面类实现
- 继承 @BasePage
- 实现核心方法
- 添加业务操作封装

### 5.2 测试类实现
- 参考 @test_demo.py
- 使用pytest标记分类
- 集成数据驱动测试

### 5.3 配置建议
- 更新 @test_config.yaml
- 添加测试数据文件
- 配置运行参数

## 6. 执行计划
- **开发阶段**: [时间规划]
- **测试阶段**: [测试安排]  
- **验收标准**: [验收条件]
```

### 4. 实现注意事项

1. **错误处理**
   - 网页无法访问时的处理
   - 页面加载超时的处理
   - 复杂页面结构的解析

2. **质量保证**
   - 测试用例的完整性检查
   - 定位器的准确性验证
   - 测试数据的合理性评估

3. **框架集成**
   - 确保生成的代码符合项目框架结构
   - 利用现有工具类 @utils/
   - 遵循项目编码规范

4. **测试点全面性检查 ⭐**
   生成测试计划时必须确认以下测试点覆盖率：
   
   #### 4.1 必须覆盖的测试点（强制）
   - [ ] 功能测试：核心功能的正向流程
   - [ ] 边界测试：所有输入字段的边界值
   - [ ] 异常测试：错误输入和异常操作
   - [ ] 数据一致性：数据的完整性和准确性
   
   #### 4.2 推荐覆盖的测试点（根据页面特性）
   - [ ] 兼容性测试：至少2个主流浏览器
   - [ ] 用户体验测试：交互反馈和页面布局
   - [ ] 安全性测试：输入安全和权限控制
   - [ ] 性能测试：关键操作的响应时间
   
   #### 4.3 测试用例优先级划分
   - **P0（最高）**：核心功能、关键业务流程、安全问题
   - **P1（高）**：常用功能、重要边界、异常处理
   - **P2（中）**：辅助功能、兼容性、性能优化
   - **P3（低）**：UI细节、边缘场景、增强功能
   
   #### 4.4 测试用例完整性标准
   每个测试用例必须包含：
   - 清晰的测试目标
   - 完整的前置条件
   - 详细的操作步骤（3步以上）
   - 明确的预期结果（至少3个检查点）
   - 合适的优先级标记
   - 明确的测试类型分类

## 输出要求
- 自动创建 `doc/` 目录（如不存在）
- 将完整测试计划保存到 @doc/test-case.md
- 提供测试计划摘要给用户
- 建议下一步的实现方案

## 测试计划质量检查清单 ✅

生成测试计划后，必须确认以下内容：

### 测试点覆盖检查
- [ ] 至少5个功能测试用例（正向流程）
- [ ] 至少3个边界测试用例（输入边界）
- [ ] 至少3个异常测试用例（错误处理）
- [ ] 至少1个兼容性测试用例（浏览器）
- [ ] 至少1个用户体验测试用例（交互反馈）
- [ ] 至少1个安全测试用例（输入安全）
- [ ] 至少1个性能测试用例（加载时间）
- [ ] 至少2个数据一致性测试用例

### 测试用例质量检查
- [ ] 每个测试用例都有清晰的前置条件
- [ ] 每个测试用例都有3步以上的详细步骤
- [ ] 每个测试用例都有明确的预期结果（3个检查点）
- [ ] 每个测试用例都标记了优先级（P0/P1/P2）
- [ ] 每个测试用例都分类了测试类型

### 页面元素覆盖检查
- [ ] 所有可交互元素都有对应的测试用例
- [ ] 所有输入框都有边界测试
- [ ] 所有按钮都有点击测试
- [ ] 所有表单都有提交测试和验证测试
- [ ] 所有链接都有跳转测试

### 测试数据完整性检查
- [ ] 有效数据集至少3组
- [ ] 无效数据集至少3组
- [ ] 边界数据集至少3组
- [ ] 特殊字符数据集至少1组

## 使用示例
用户输入：
```
请分析这个页面并生成测试计划：https://example.com/login
```

系统响应：
1. 使用Playwright访问页面
2. 解析页面结构和元素
3. 生成详细测试计划
4. 保存到doc/test-case.md
5. 提供实现建议