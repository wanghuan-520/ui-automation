# UI自动化测试计划生成规则

## 规则概述
当用户提供一个网页链接时，自动使用Playwright MCP工具解析页面，并生成详细的UI自动化测试计划，保存到 @doc/test-case.md 文件中。

## 触发条件
- 用户消息包含HTTP/HTTPS链接
- 用户明确要求生成测试计划
- 用户提到"测试用例"、"自动化测试"、"UI测试"等关键词

## 执行步骤

### 1. 页面解析阶段
使用以下Playwright MCP工具按顺序执行：

1. **导航到页面**
   ```
   mcp_playwright-mcp-server_playwright_navigate
   - url: 用户提供的链接
   - headless: false (方便调试)
   - width: 1920
   - height: 1080
   ```

2. **获取页面HTML结构**
   ```
   mcp_playwright-mcp-server_playwright_get_visible_html
   - cleanHtml: true
   - removeScripts: true
   - removeStyles: false
   - maxLength: 20000
   ```

3. **截取页面截图**
   ```
   mcp_playwright-mcp-server_playwright_screenshot
   - name: "page_analysis"
   - fullPage: true
   - savePng: true
   ```

4. **获取页面文本内容**
   ```
   mcp_playwright-mcp-server_playwright_get_visible_text
   ```

### 2. 测试计划生成阶段

基于解析结果，生成包含以下内容的测试计划：

#### 2.1 页面基本信息
- 页面标题和URL
- 页面类型识别（登录页、列表页、详情页等）
- 主要功能模块识别

#### 2.2 UI元素分析
- **表单元素**：输入框、下拉框、按钮等
- **导航元素**：菜单、链接、面包屑等
- **展示元素**：表格、列表、卡片等
- **交互元素**：弹窗、标签页、手风琴等

#### 2.3 测试用例规划
为每个功能模块生成：
- **功能测试用例**：正常流程验证
- **边界测试用例**：输入验证、边界值测试
- **异常测试用例**：错误处理、网络异常等
- **兼容性测试用例**：多浏览器、响应式等

#### 2.4 页面对象模型设计
基于我们的框架结构 @pages/base_page.py，设计：
- 页面类名和继承关系
- 元素定位器定义
- 页面操作方法定义

#### 2.5 测试数据规划
参考 @test_data/login_data.json 格式：
- 有效数据集
- 无效数据集
- 边界数据集

### 3. 文档生成规则

生成的测试计划文档应包含：

```markdown
# [页面名称] UI自动化测试计划

## 1. 页面概述
- **URL**: [页面链接]
- **页面类型**: [页面类型]
- **主要功能**: [功能描述]
- **测试优先级**: [高/中/低]

## 2. 页面元素映射
### 2.1 关键元素识别
| 元素类型 | 元素描述 | 定位策略 | 定位器 |
|---------|----------|----------|--------|
| 输入框 | 用户名输入 | ID | #username |
| 按钮 | 登录按钮 | ID | #login-btn |

### 2.2 页面对象设计
```python
class [PageName]Page(BasePage):
    # 元素定位器
    ELEMENT_SELECTOR = "#element"
    
    def navigate(self):
        # 导航逻辑
        pass
    
    def is_loaded(self):
        # 页面加载检查
        pass
```

## 3. 测试用例设计
### 3.1 功能测试用例
- **TC001**: [测试用例名称]
  - **前置条件**: [条件描述]
  - **测试步骤**: [步骤列表]
  - **预期结果**: [结果描述]
  - **优先级**: [高/中/低]

### 3.2 边界测试用例
### 3.3 异常测试用例

## 4. 测试数据设计
```json
{
  "valid_data": [
    {
      "field1": "value1",
      "field2": "value2"
    }
  ],
  "invalid_data": [
    {
      "field1": "",
      "field2": "invalid"
    }
  ]
}
```

## 5. 自动化实现建议
### 5.1 页面类实现
- 继承 @BasePage
- 实现核心方法
- 添加业务操作封装

### 5.2 测试类实现
- 参考 @test_demo.py
- 使用pytest标记分类
- 集成数据驱动测试

### 5.3 配置建议
- 更新 @test_config.yaml
- 添加测试数据文件
- 配置运行参数

## 6. 执行计划
- **开发阶段**: [时间规划]
- **测试阶段**: [测试安排]  
- **验收标准**: [验收条件]
```

### 4. 实现注意事项

1. **错误处理**
   - 网页无法访问时的处理
   - 页面加载超时的处理
   - 复杂页面结构的解析

2. **质量保证**
   - 测试用例的完整性检查
   - 定位器的准确性验证
   - 测试数据的合理性评估

3. **框架集成**
   - 确保生成的代码符合项目框架结构
   - 利用现有工具类 @utils/
   - 遵循项目编码规范

## 输出要求
- 自动创建 `doc/` 目录（如不存在）
- 将完整测试计划保存到 @doc/test-case.md
- 提供测试计划摘要给用户
- 建议下一步的实现方案

## 使用示例
用户输入：
```
请分析这个页面并生成测试计划：https://example.com/login
```

系统响应：
1. 使用Playwright访问页面
2. 解析页面结构和元素
3. 生成详细测试计划
4. 保存到doc/test-case.md
5. 提供实现建议